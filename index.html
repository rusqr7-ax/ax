<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A | X System</title>
  <link rel="icon" href="faviconarmani.png">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  
  <!-- CSS -->
  <link rel="stylesheet" href="css/style.css">

  <!-- SCRIPTS -->
  <!-- 1. External Deps -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- 2. Config & API -->
  <script src="js/supabase-config.js"></script>
  <script src="js/api.js"></script>
  <script src="js/seed_shifts.js"></script>
  
  <!-- 3. Components -->
  <script src="js/calendar.js"></script>
  <script src="js/schedule.js"></script>
  
  <!-- 4. Main Logic -->
  <script src="js/main.js" defer></script>
</head>
<body>

  <!-- ==================== LOGIN VIEW ==================== -->
  <div id="login-view" class="container login-card" style="display:flex; height: 100vh; flex-direction: column; justify-content: center;">
    <div class="logo">A | X</div>
    <h2>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
    <p style="margin-bottom: 20px; color: #666;">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</p>
    
    <input type="text" id="loginEmail" placeholder="–õ–æ–≥–∏–Ω" class="input-field">
    
    <div class="password-wrapper">
      <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" class="input-field" style="margin-bottom: 0;">
      <div class="password-toggle" id="togglePassword">
        <svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </div>
    </div>
    
    <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" id="btnLogin">–í–æ–π—Ç–∏</button>
    <div id="loginErrorMsg" style="color: #f44336; margin-top: 15px; font-size: 14px; min-height: 20px;"></div>
  </div>

  <!-- ==================== APP VIEW ==================== -->
  <div id="app-view" class="container" style="display:none;">
    <div class="header">
      <div class="header-left">
        <h1>A | X</h1>
      </div>
      
      <div class="actions">
        <div class="profile-menu-container">
          <button class="profile-btn" id="profileBtn">
            <div class="profile-info">
               <span class="profile-name" id="headerLogin">...</span> 
               <span class="profile-role" id="headerRole">...</span>
            </div>
            <img src="https://ui-avatars.com/api/?name=User&background=333&color=fff" class="profile-avatar" id="headerAvatar" alt="Foto">
          </button>
          
          <div class="dropdown-menu" id="profileMenu">
            <button id="themeBtn" class="menu-item">
               <span>üåì</span> –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É
            </button>
            <button id="changePhotoBtn" class="menu-item">
               <span>üì∏</span> –°–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ
            </button>
            <button id="changePassBtn" class="menu-item">
               <span>üîí</span> –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
            </button>
            <button id="logoutBtn" class="menu-item" style="color: #f44336;">
               <span>üö™</span> –í—ã–π—Ç–∏
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL: CHANGE PASSWORD -->
    <div id="modalChangePass" class="modal-overlay">
      <div class="modal">
        <span class="close-modal" onclick="document.getElementById('modalChangePass').style.display='none'">&times;</span>
        <h3 style="margin-bottom:20px;">–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h3>
        <input type="password" id="oldPass" placeholder="–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å" class="input-field">
        <input type="password" id="newPass" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" class="input-field">
        <button class="btn btn-primary" id="btnSavePass" style="width:100%">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>

    <!-- MODAL: ADD SHIFT TYPE -->
    <div id="modalAddShift" class="modal-overlay">
      <div class="modal">
        <span class="close-modal" onclick="document.getElementById('modalAddShift').style.display='none'">&times;</span>
        <h3 style="margin-bottom:20px;">–ù–æ–≤–∞—è —Å–º–µ–Ω–∞</h3>
        <input type="text" id="newShiftTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –°–º–µ–Ω–∞ 1)" class="input-field">
        <div style="display:flex; gap:10px;">
          <input type="time" id="newShiftStart" class="input-field" title="–ù–∞—á–∞–ª–æ">
          <input type="time" id="newShiftEnd" class="input-field" title="–ö–æ–Ω–µ—Ü">
        </div>
        <button class="btn btn-primary" id="btnSaveNewShift" style="width:100%">–°–æ–∑–¥–∞—Ç—å</button>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" data-tab="schedule">–ì—Ä–∞—Ñ–∏–∫</button>
      <button class="tab" data-tab="tab-1s">1–°</button>
      <button class="tab" data-tab="merch">–ú–µ—Ä—á</button>
      <button class="tab" data-tab="operations">–û–ø–µ—Ä–∞—Ü–∏–∏</button>
      <button class="tab" data-tab="admin" id="adminTab" style="display:none">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</button>
    </div>

    <!-- CONTENT: SCHEDULE -->
    <div class="tab-content active" id="schedule">
      <div class="schedule-switch">
        <button class="btn btn-sm active" id="viewMySched">–ú–æ–π</button>
        <button class="btn btn-sm" id="viewTeamSched">–û–±—â–∏–π</button>
      </div>
      
      <div id="myScheduleView">
        <div id="calendar-wrapper"></div>
      </div>

      <div id="teamScheduleView" style="display:none;">
        <div id="schedule-manager"></div>
      </div>
    </div>

    <!-- CONTENT: OPERATIONS -->
    <div class="tab-content" id="operations">
      <h2>–û–ø–µ—Ä–∞—Ü–∏–∏</h2>
      <p>–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
    </div>

    <!-- CONTENT: 1S -->
    <div class="tab-content" id="tab-1s">
      <h2>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ 1–°</h2>
      <input type="text" class="input-field search-input" placeholder="–ü–æ–∏—Å–∫ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π...">
      <div class="list-group" style="margin-top: 20px;"></div>
    </div>

    <!-- CONTENT: MERCH -->
    <div class="tab-content" id="merch">
      <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
        <h2>–ú–µ—Ä—á–∞–Ω–¥–∞–π–∑–∏–Ω–≥</h2>
        <button class="btn btn-sm" id="btnUploadMerch">–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</button>
        <input type="file" id="uploadMerchInput" hidden accept="image/*">
      </div>
      <div class="merch-grid" id="merchGrid"></div>
    </div>

    <!-- CONTENT: ADMIN -->
    <div class="tab-content" id="admin">
      <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</h2>
      <div style="margin-bottom: 20px; padding: 20px; border: 1px solid var(--border-color);">
        <h3>–ù–æ–≤—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫</h3>
        <input type="text" id="newUserName" placeholder="–§–ò–û" class="input-field">
        <input type="text" id="newUserEmail" placeholder="–õ–æ–≥–∏–Ω" class="input-field">
        <input type="text" id="newUserPass" placeholder="–ü–∞—Ä–æ–ª—å" class="input-field">
        <select id="newUserRole" class="input-field">
          <option value="seller">–ü—Ä–æ–¥–∞–≤–µ—Ü</option>
          <option value="senior_seller">–°—Ç–∞—Ä—à–∏–π –ø—Ä–æ–¥–∞–≤–µ—Ü</option>
          <option value="director">–î–∏—Ä–µ–∫—Ç–æ—Ä</option>
        </select>
        <button class="btn btn-primary" id="btnCreateUser">–°–æ–∑–¥–∞—Ç—å</button>
      </div>
      
      <table id="usersTable">
        <thead>
          <tr>
            <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
            <th>–†–æ–ª—å</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    (function() {
      try {
        var hasUser = !!localStorage.getItem('ax_user');
        var lv = document.getElementById('login-view');
        var av = document.getElementById('app-view');
        if (lv && av) {
          lv.style.display = hasUser ? 'none' : 'flex';
          av.style.display = hasUser ? 'block' : 'none';
        }
      } catch (e) {}
    })();
  </script>
</body>
</html>
